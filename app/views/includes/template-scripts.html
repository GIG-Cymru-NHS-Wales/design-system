
<script>_satellite["_runScript1"](function(event, target, Promise) {
    try {
      document.dispatchEvent(new Event('nhsa.stitching-identifier-unavailable'));
    } catch (e) {
      console.error('Error dispatching nhsa.stitching-identifier-unavailable event: ', e);
    }

  });
  </script>

  <script>_satellite["_runScript2"](function(event, target, Promise) {
  //console.debug('AS: QP rule init fired');

  var allowList = _satellite.getVar("Analytics Stitching - Allow List");
  if (allowList !== undefined && allowList !== null && allowList.size > 0) {
    //console.debug("AS: Allow List loaded successfully");

    document.addEventListener("click", (ev) => {
      if (ev.target.tagName === "A" && ev.target.hasAttribute("href")) {
        //console.log("AS: <a> tag located with href", ev.target.href);

        try {
          var sub = _satellite.getVar("Analytics Stitching - Cookie Value");

          if (!sub || sub === undefined) {
            //console.debug("AS: cid ");
            return;
          }
          
          if (allowList.has(ev.target.href)) {
            //console.log(`AS: ${ev.target.href} is in allow list`);
            var newHref = allowList.get(ev.target.href);

            //console.log(`AS: ${newHref} identified as replacement href for target`);
            ev.target.href = newHref.replace("SUB_ID", sub);
            //console.log(`AS: ${ev.target.href} is updated href`);
          }// else {
            //console.log(`AS: ${ev.target.href} is not in allow list`);
          //}
        } catch (error) {
          console.error("AS: Error executing add query parameter rule", error);
          document.dispatchEvent(new CustomEvent("nhsa.stitching-identifier-error", { detail: error }));
        }
      }
    });
  }// else {
    //console.debug("AS: No Allow List");
  //}

  });
  </script>

  <script>
    _satellite["_runScript3"](function(event, target, Promise) {
    function getParameterByName(e,t){t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var a=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return a?a[2]?decodeURIComponent(a[2].replace(/\+/g," ")):"":null}function getElmPosition(e,t){var a=e,r=t,l=(parseInt(Array.prototype.slice.call(r).indexOf(a))+1).toString(),n="0";return l!=n?l:n}function getPositionFromRange(e){var t=10*Math.ceil(e/10),a=t-10;console.log(a),console.log(t);for(var r=[],l=a;l<=t;l++){var n=l;n<=t&&r.push(n)}return r}function getSearchLink(){window.elm=this;var e="",t="",a={};if(!/^[0-9]+/.test(elm.textContent.trim()))if(/\/search\//.test(window.location.pathname)||/\/search(\/?)\?/.test(window.location.href)){if(t=document.querySelectorAll("#search-results li h2 a"),a.name=elm.textContent.trim().replace(/\s\s+/g,""),a.target=elm.title,a.service="",a.location=digitalData.search.keyword,a.category="web: main search",document.querySelectorAll(".number-of-results").length>0){if(getParameterByName("start_rank")){var r=getPositionFromRange(parseFloat(getParameterByName("start_rank")));if(r.length>0){var l=parseFloat(getElmPosition(elm,t));a.rank=r[l].toString()}}else a.rank=getElmPosition(elm,t);a.resultSelected=e.concat("K:",window.digitalData.search.keyword,"|","C:",a.name,"|","R:",a.rank)}}else/service\-search/.test(window.location.pathname)?(t=document.querySelectorAll("[axis=location] a").length>0?document.querySelectorAll("[axis=location] a"):document.querySelectorAll(".consultants-list a").length>0?document.querySelectorAll(".consultants-list a"):document.querySelectorAll("td[data-th=Organisation] a").length?document.querySelectorAll("td[data-th=Organisation] a"):[],a.name=elm.textContent.trim().replace(/\s\s+/g,""),a.target=elm.href,a.category="web: service search",a.service=document.querySelectorAll(".findcompare-results h1").length>0?document.querySelectorAll(".findcompare-results h1")[0].textContent.replace(/Results\sfor\s/,"").replace(/\s.+/,""):"",(_satellite.getVar("distance query")||_satellite.getVar("Location.Name query")||_satellite.getVar("LocationName query"))&&/service\-search/.test(window.location.pathname)&&(a.rank=getElmPosition(elm,t),a.resultSelected=e.concat("S:",window.digitalData.search.service,"|","L:",a.name,"|","R:",a.rank))):/\/searchapps/.test(window.location.pathname)&&(t=document.querySelectorAll(".cardapp h3 a"),elm=elm.className.match(/img/)?elm.parentElement.querySelectorAll("h3 a")[0].parentElement.querySelectorAll("h3 a")[0]:elm,a.name=elm.textContent.trim().replace(/\s\s+/g,""),a.target=elm.href,a.rank=getElmPosition(elm,t),a.service="",a.location=digitalData.search.keyword,a.category="web: apps library",a.resultSelected=e.concat("K:",window.digitalData.search.keyword,"|","C:",a.name,"|","R:",a.rank));(elm.tagName=!/\#/.test(elm.href))&&(a.link={},a.link.name=-1==elm.textContent.trim().indexOf("#")?elm.textContent.trim():"",a.link.url=elm.href,console.log(a)),a.clickSearch=!0,localStorage.removeItem("searchParams"),localStorage.setItem("searchParams",JSON.stringify(a))}if(void 0===window.digitalData?window.digitalData={search:{keyword:"",results:"",section:/service\-search/.test(window.location.pathname)&&!/performance\//i.test(window.location.pathname)?"web: service search":/\/search/.test(window.location.pathname)?"web: main search":"",link:{}},link:{}}:(window.digitalData=window.digitalData,window.digitalData.search={keyword:"",results:"",section:/service\-search/.test(window.location.pathname)&&!/performance\//i.test(window.location.pathname)?"web: service search":/\/search/.test(window.location.pathname)?"web: main search":"",link:{}},window.digitalData.link={}),/\/search\//.test(window.location.pathname)||/\/search(\/?)\?/.test(window.location.href))digitalData.search.keyword=getParameterByName("q")?getParameterByName("q"):getParameterByName("query")?getParameterByName("query"):"",digitalData.search.results=document.querySelectorAll(".number-of-results").length>0?document.querySelectorAll(".number-of-results")[0].textContent.replace(/[^0-9]+/g,""):"0",(document.querySelectorAll("h2").length>0&&document.querySelectorAll("h2")[0].textContent.indexOf("No results found for")>-1||document.querySelectorAll(".no-results-wrap.pad").length>0&&document.querySelectorAll(".no-results-wrap.pad")[0].textContent.indexOf("No results found for")>-1)&&(digitalData.search.failedSearchReason="true",digitalData.search.failedSearchReason=document.querySelectorAll("h2").length>0?document.querySelectorAll("h2")[0].textContent.replace(/\s\s/g,""):document.querySelectorAll(".no-results-wrap.pad h1").length>0?document.querySelectorAll(".no-results-wrap.pad h1")[0].textContent.replace(/\s\s/g,""):"");else if(/\/service\-search/.test(window.location.pathname))document.querySelectorAll(".findcompare-results h1").length>0?document.querySelectorAll(".findcompare-results h1")[0].textContent.indexOf("Results for")>-1?(digitalData.search.service=$("#main-content > div > h1 > span:nth-child(1)").text(),digitalData.search.results=document.querySelectorAll(".fcresultsinfo li").length>0?document.querySelectorAll(".fcresultsinfo li")[0].textContent.replace(/Showing \d+\-\d+ of /,"").trim().replace(" results",""):"0",digitalData.search.location=document.querySelectorAll("#locname").length>0?document.querySelectorAll("#locname")[0].textContent:""):document.querySelectorAll(".findcompare-results h1")[0].textContent.indexOf("Consultants named")>-1?(digitalData.search.consultant=document.querySelectorAll(".findcompare-results h1").length>0?document.querySelectorAll(".findcompare-results h1")[0].textContent.replace("Consultants named '","").replace(/\'.+/,""):"",digitalData.search.location=document.querySelectorAll(".findcompare-results h1").length>0&&/.+near\s(?=([a-zA-Z0-9]+))/.exec(document.querySelectorAll(".findcompare-results h1")[0].textContent).length>1?/.+near\s(?=([a-zA-Z0-9]+))/.exec(document.querySelectorAll(".findcompare-results h1")[0].textContent)[1]:"",digitalData.search.speciality=document.querySelectorAll(".findcompare-results h1").length>0&&/.+services\sin\s(?=([a-zA-Z0-9\s]+))/.exec(document.querySelectorAll(".findcompare-results h1")[0].textContent)&&/.+services\sin\s(?=([a-zA-Z0-9\s]+))/.exec(document.querySelectorAll(".findcompare-results h1")[0].textContent).length>1?/.+services\sin\s(?=([a-zA-Z0-9\s]+))/.exec(document.querySelectorAll(".findcompare-results h1")[0].textContent)[1]:"",digitalData.search.results=document.querySelectorAll(".findcompare-results h1").length>0&&document.querySelectorAll(".fcresultsinfo.clear li").length>0?document.querySelectorAll(".fcresultsinfo.clear li")[0].textContent.replace(/.+of\s/,""):"0"):document.querySelectorAll("#locname").length>0&&(digitalData.search.location=document.querySelectorAll("#locname").length>0?document.querySelectorAll("#locname")[0].textContent:""):document.querySelectorAll(".findcompare-search.mapview.urgent-care").length>0?(digitalData.search.service="",digitalData.search.section="web: service search",digitalData.search.results=document.querySelectorAll(".findcompare-search.mapview.urgent-care>p").length>0?document.querySelectorAll(".findcompare-search.mapview.urgent-care>p")[0].textContent.replace(/Showing 1-\d+ of /,"").replace(/ results/,"").trim():"0",digitalData.search.location=document.querySelectorAll(".findcompare-search.mapview.urgent-care #top span").length>0?document.querySelectorAll(".findcompare-search.mapview.urgent-care #top span")[0].textContent.trim():""):document.querySelectorAll("#OrganisationNameSearchValue").length>0&&(digitalData.search.service=document.querySelectorAll("#dropdownMenu1").length>0?document.querySelectorAll("#dropdownMenu1")[0].textContent.trim():"",digitalData.search.section="web: service search - mynhs",digitalData.search.results=document.querySelectorAll(".betaresultsinfo .number").length>0?document.querySelectorAll(".betaresultsinfo__current.text-underline")[0].textContent.replace(/\s\s/g,"").replace(/Showing\d+\-\d+of/,"").replace("results","").trim():"0",digitalData.search.location=document.querySelectorAll("#LocationName").length>0?document.querySelectorAll("#LocationName")[0].value:""),(document.querySelectorAll("#validation-summary-errors").length>0||document.querySelectorAll(".row.no-results h2").length>0&&document.querySelectorAll(".row.no-results h2")[0].textContent.indexOf("No results found")>-1)&&(digitalData.search.service=document.querySelectorAll("#Service_Name").length>0?document.querySelectorAll("#Service_Name")[0].value:document.querySelectorAll("#dropdownMenu1").length>0?document.querySelectorAll("#dropdownMenu1")[0].textContent.trim():"",digitalData.search.location=document.querySelectorAll("#Location_Name").length>0?document.querySelectorAll("#Location_Name")[0].value:document.querySelectorAll("#LocationName").length>0?document.querySelectorAll("#LocationName")[0].value:"",digitalData.search.consultant=document.querySelectorAll("input.consultant-name").length>0?document.querySelectorAll("input.consultant-name")[0].value:document.querySelectorAll("#ConsultantName").length>0?document.querySelectorAll("#ConsultantName")[0].value:"",digitalData.search.speciality=document.querySelectorAll("#Specialty option[selected]").length>0?document.querySelectorAll("#Specialty option[selected]")[0].textContent:"",digitalData.search.failedSearchReason="true",digitalData.search.failedSearchReason=document.querySelectorAll("#validation-summary-errors p").length>0?document.querySelectorAll("#validation-summary-errors p")[0].textContent.replace(/\s\s/g,""):document.querySelectorAll(".row.no-results h2").length>0?document.querySelectorAll(".row.no-results h2")[0].textContent.replace(/\s\s/g,""):"",digitalData.search.section=document.querySelectorAll(".row.no-results h2").length>0?"web: service search - mynhs":digitalData.search.section,digitalData.search.results="0");else if(/\/searchapps/.test(window.location.pathname))digitalData.search.keyword=getParameterByName("query"),digitalData.search.results=document.querySelectorAll(".cardapp").length.toString(),digitalData.search.section="web: apps library",document.querySelectorAll("h2.aaw-search-header").length>0&&document.querySelectorAll("h2.aaw-search-header")[0].textContent.indexOf("Sorry, no results were found for")>-1&&(digitalData.search.failedSearch="true",digitalData.search.failedSearchReason=document.querySelectorAll("h2.aaw-search-header").length>0?document.querySelectorAll("h2.aaw-search-header")[0].textContent.replace(/\s\s/g,""):"");else if(/\/find\-a\-pharmacy\/results/.test(window.location.pathname)){var locationTxt=document.querySelectorAll(".nhsuk-page-heading h1").length>0?document.querySelectorAll(".nhsuk-page-heading h1")[0].textContent.replace(/Pharmacies near /,""):"";digitalData.search.section="web: pharmacy finder",""!=locationTxt&&(digitalData.search.location=locationTxt)}if(localStorage.getItem("searchParams")&&localStorage.getItem("searchParams").indexOf("clickSearch")>-1){var searchParamsObj=null!=localStorage.getItem("searchParams")?JSON.parse(localStorage.getItem("searchParams")):null;searchParamsObj&&searchParamsObj.link&&void 0!==searchParamsObj.link.url&&-1==searchParamsObj.link.url.indexOf("#")&&(window.digitalData.link.name=null!=searchParamsObj&&-1==searchParamsObj.link.url.indexOf("#")?searchParamsObj.link.name:"",window.digitalData.link.url=null!=searchParamsObj?searchParamsObj.link.url:"",window.digitalData.search.link.target=null!=searchParamsObj&&""!=searchParamsObj.target?searchParamsObj.target:window.location.href,window.digitalData.search.link.rank=null!=searchParamsObj?searchParamsObj.rank:"",window.digitalData.search.link.resultSelected=null!=searchParamsObj?searchParamsObj.resultSelected:"",localStorage.removeItem("searchParams"))}for(var searchResultLinks=document.querySelectorAll("#search-results li a"),i=0;i<searchResultLinks.length;i++){(currentSearchLink=searchResultLinks[i]).addEventListener("click",getSearchLink)}var searchServiceResultLinks=document.querySelectorAll("[axis=location] a");for(i=0;i<searchServiceResultLinks.length;i++){var currentSearchLink;(currentSearchLink=searchServiceResultLinks[i]).addEventListener("click",getSearchLink)}var searchServiceAppResultLinks=document.querySelectorAll(".cardapp a");for(i=0;i<searchServiceAppResultLinks.length;i++){var currentSearchAppLink=searchServiceAppResultLinks[i];currentSearchAppLink.addEventListener("click",getSearchLink)}var searchServiceConsultantsResultLinks=document.querySelectorAll(".consultants-list a");for(i=0;i<searchServiceConsultantsResultLinks.length;i++){var currentSearchConsultantLink=searchServiceConsultantsResultLinks[i];currentSearchConsultantLink.addEventListener("click",getSearchLink)}var searchServiceMyAppsResultLinks=document.querySelectorAll("td[data-th=Organisation] a");for(i=0;i<searchServiceMyAppsResultLinks.length;i++){var currentSearchServiceAppLink=searchServiceMyAppsResultLinks[i];currentSearchServiceAppLink.addEventListener("click",getSearchLink)}var allLinks=document.querySelectorAll("a");for(i=0;i<allLinks.length;i++){var currentAllLinks=allLinks[i];currentAllLinks.addEventListener("click",getSearchLink)}
    });
  </script>

  <script type="module" src="/javascripts/nhsuk-frontend.min.js"></script>
  
  <script type="module">
      import { initAll } from '/javascripts/nhsuk-frontend.min.js'
      initAll()
  </script>
  